# 漢字テストジェネレーター

バンコクの「プログラミングのKOBEYA」で使用する、小学生向け漢字学習アプリです。

## 🎯 プロジェクト概要

小学校1年生〜6年生で習う1026字の漢字を、楽しく効果的に学習できるWebアプリケーションです。

### 主な特徴

- 📝 **プリント生成機能**：学年別・出題数選択可能
- ✏️ **手書き練習機能**：タッチデバイス対応
- 📱 **PWA対応**：オフライン動作、ホーム画面追加可能
- 🎨 **直感的なUI**：子供でも使いやすいデザイン
- 💾 **データ編集機能**：例文・読み仮名のカスタマイズ

---

## 🚀 機能一覧

### 1. プリント生成（index.html）

**機能：**
- 学年別漢字選択（小1〜小6）
- 出題数選択（10問/20問）
- テストモード選択（読みテスト/書きテスト/練習+テスト）
- 印刷機能
- 編集モード
- 解答表示切り替え

**使い方：**
1. 各学年から出題する漢字数を選択
2. テストモードを選択
3. 「プリント生成」をクリック
4. 印刷または編集

---

### 2. 手書き練習（practice.html）

**機能：**
- **練習モード**：漢字をなぞって練習（4マス）
- **テストモード**：縦書きレイアウトで問題文を読んで解答
- ペン設定（太さ・色変更）
- **消しゴム機能**：一部を消せる
- 全消去機能
- スクリーンショット保存
- タッチ・マウス対応

**使い方：**
1. index.htmlで漢字を選択
2. 「✏️ 手書き練習」をクリック
3. 練習モードでなぞり書き
4. 「練習完了 → テスト開始」でテストモードへ

---

### 3. 漢字データ編集（editor.html）

**機能：**
- 全1026字の漢字データ編集
- 例文の追加・修正・削除
- 読み仮名の編集
- LocalStorage保存
- デフォルトに戻す機能

**使い方：**
1. 漢字を検索または一覧から選択
2. 例文・読み仮名を編集
3. 「💾 保存」で変更を保存

---

### 4. 検証ツール

**漢字重複チェッカー（check_duplicates.html）**
- 学年間の重複チェック
- 統計情報表示

**不足漢字チェック（check_missing.html）**
- 小1の80字完全性チェック
- 不足・余分な漢字の検出

---

## 📂 ファイル構成

```
漢字テストジェネレーター/
├── index.html              # メイン画面（プリント生成）
├── practice.html           # 手書き練習画面
├── editor.html             # 漢字データ編集画面
├── check_duplicates.html   # 重複チェックツール
├── check_missing.html      # 不足チェックツール
├── json_validator.html     # JSON検証ツール
│
├── app.js                  # メイン機能のJavaScript
├── practice.js             # 手書き練習のJavaScript
├── editor.js               # 編集機能のJavaScript
├── style.css               # メインスタイル
├── practice.css            # 手書き練習スタイル
│
├── manifest.json           # PWAマニフェスト
├── service-worker.js       # Service Worker（オフライン対応）
│
├── icons/                  # アプリアイコン
│   ├── icon-512x512.png    # 512x512アイコン
│   ├── icon-192x192.png    # 192x192アイコン
│   └── favicon.ico         # ファビコン
│
└── data/                   # 漢字データ（JSON）
    ├── grade1_kanji.json   # 小1（80字）
    ├── grade2_kanji.json   # 小2（160字）
    ├── grade3_kanji.json   # 小3（200字）
    ├── grade4_kanji.json   # 小4（202字）
    ├── grade5_kanji.json   # 小5（193字）
    └── grade6_kanji.json   # 小6（191字）
```

---

## 🗄️ データ構造

### 漢字データ（JSON形式）

```json
{
  "kanji": "音",
  "yomi": "オン、おと、ね",
  "meaning": "おと",
  "examples": [
    "音をきく",
    "音楽のじゅぎょう"
  ],
  "readings": {
    "音": "オト",
    "音を": "オトを",
    "音をきく": "オトをきく",
    "音楽のじゅぎょう": "オンガクのじゅぎょう"
  }
}
```

---

## 💾 データ保存

### LocalStorage使用項目

- `kanji_selection_{grade}`: 各学年の選択状態
- `kanji_edited_data`: 編集済み漢字データ
- `kanji_history`: 出題履歴（最大100件）
- `default_kanji_count`: デフォルト出題数
- `default_test_mode`: デフォルトテストモード
- `exclude_recent_count`: 除外する履歴件数

---

## 🎨 デザインテーマ

### カラーパレット
- プライマリー：`#667eea` → `#764ba2`（グラデーション）
- アクセント：`#c0392b`（赤）
- テキスト：`#333`
- 背景：`#f8f9fa`

### フォント
- メイン：`Noto Sans JP`（Google Fonts）
- 手書きエリア：`MS Gothic`、`Hiragino Kaku Gothic Pro`

---

## 🔧 技術スタック

- **HTML5**：セマンティックマークアップ
- **CSS3**：Flexbox、Grid、縦書き（`writing-mode: vertical-rl`）
- **JavaScript (ES6+)**：非同期処理、LocalStorage
- **Canvas API**：手書き機能
- **PWA**：manifest.json、Service Worker

---

## 📱 PWA対応状況

### ✅ 実装済み
- ✅ manifest.json（アプリ情報）
- ✅ service-worker.js（オフライン対応）
- ✅ アプリアイコン（512x512、192x192）
- ✅ ファビコン
- ✅ iOS対応（apple-touch-icon）
- ✅ ホーム画面追加機能
- ✅ オフライン動作
- ✅ LocalStorage（データ保存）
- ✅ レスポンシブデザイン（スマホ完全対応）

### 🎯 PWAの使い方

**iPhone/iPad（Safari）：**
1. https://rehtxojd.gensparkspace.com/ を開く
2. 共有ボタン（↑）をタップ
3. 「ホーム画面に追加」を選択
4. 「追加」をタップ
5. ホーム画面のアイコンからアプリのように起動

**Android（Chrome）：**
1. https://rehtxojd.gensparkspace.com/ を開く
2. メニュー（⋮）をタップ
3. 「ホーム画面に追加」または「アプリをインストール」を選択
4. 「追加」をタップ
5. ホーム画面のアイコンからアプリのように起動

**オフライン動作：**
- 一度アプリを開くとファイルがキャッシュされます
- 機内モードやWi-Fiオフでも動作します
- データはLocalStorageに保存されます

---

## 🚀 将来の機能（ロードマップ）

### フェーズ1：PWA化 ✅ 完了！
- [x] 基本機能実装
- [x] manifest.json作成
- [x] service-worker.js作成
- [x] アイコン準備
- [x] PWAテスト
- [x] スマホ完全対応

### フェーズ2：機能拡張
- [ ] 学習進捗の記録
- [ ] 間違えた漢字の復習機能
- [ ] ゲーム要素の追加
- [ ] 音声読み上げ

### フェーズ3：ネイティブアプリ化
- [ ] Capacitorでネイティブ化
- [ ] App Store申請
- [ ] Google Play申請

---

## 📊 データ統計

- **総漢字数**：1026字
- **小1**：80字
- **小2**：160字
- **小3**：200字
- **小4**：202字
- **小5**：193字
- **小6**：191字

---

## 🧪 テスト環境

### 動作確認済み
- ✅ Chrome（デスクトップ）
- ✅ Safari（iOS）
- ✅ Chrome（Android）
- ✅ iPad（Safari）

### 推奨環境
- モダンブラウザ（最新版）
- タッチデバイス推奨（手書き練習）

---

## 📝 開発メモ

### 重要な設計方針

1. **縦書きレイアウト**
   - `writing-mode: vertical-rl`を使用
   - 問題文エリアは`display: flex`を使わない（数字が下に落ちる問題を回避）

2. **数字の表示**
   - `text-combine-upright: all`で縦中横表示

3. **Canvas描画**
   - タッチイベントとマウスイベント両対応
   - 3層構造（背景・ガイド・描画）

4. **データ管理**
   - JSONファイルとLocalStorageの併用
   - 編集データは上書き保存

---

## 👨‍🏫 制作者

**プログラミングのKOBEYA**
- 代表：鈴木政路（すずき まさみち）
- 所在地：バンコク、フジスーパー2号店2階
- 対象：在タイ日本人向けプログラミング教室

---

## 📄 ライセンス

このプロジェクトは教育目的で作成されています。

---

## 🔄 更新履歴

### 2026-01-28 v2.3.2 🎉 iPadデバッグツール追加！
- ✅ **Eruda（デバッグツール）を追加**
- ✅ URLに `?debug=true` を追加すると、iPad単体でコンソールを確認可能
- ✅ 使い方: https://kanji-test-generator.pages.dev/practice.html?debug=true
- ✅ 画面右下にデバッグボタンが表示される
- ✅ コンソールログをiPad単体で確認できる

### 2026-01-28 v2.3.1 🎉 iPad描画問題のデバッグ強化！
- ✅ **iPadでのCanvas描画問題を調査するため、詳細なデバッグログを追加**
- ✅ タッチイベント開始時にCanvas情報を出力
- ✅ タッチ移動時に座標情報を出力（最初の3回）
- ✅ test-canvasのCSSを強化（min/max-width/heightを追加）
- ✅ box-sizing、border、padding、marginを明示的に指定

### 2026-01-28 v2.3.0 🎉 テストモード選択の完全対応！
- ✅ **テスト10問・テスト20問の場合、練習モードを表示しない**
- ✅ テストモード情報をURLパラメータで渡す（mode=practice/test10/test20）
- ✅ テスト10問: 最初からテストモードのみ表示（10問）
- ✅ テスト20問: 最初からテストモードのみ表示（20問、同じ漢字を2回出題）
- ✅ 練習＋テスト: 練習モードとテストモードを切り替え可能
- ✅ テスト10問・テスト20問の場合、モード切り替えボタンを非表示

### 2026-01-28 v2.2.2 🎉 消しゴムの太さが正しく反映されるように修正！
- ✅ **消しゴムで実際に消える範囲が正しく反映されるようになりました**
- ✅ lineWidthにスケール調整（scaleX）を適用
- ✅ スライダーで太さを変更すると、実際の消しゴムの範囲も変わる
- ✅ カーソルの円と実際の消しゴムの範囲が一致

### 2026-01-28 v2.2.1 🎉 テストモード描画の完全修正 + 消しゴム可視化！
- ✅ **テストモードの描画問題を根本解決**
- ✅ Canvasを絶対配置に変更（カッコに圧迫されない）
- ✅ 真ん中以外でも正常に線が描ける
- ✅ 横線も途中で切れない
- ✅ **消しゴムの範囲を円形カーソルで可視化**
- ✅ 消しゴムの太さをスライダーで変更すると、カーソルの円も変わる
- ✅ オレンジ色の円でわかりやすく表示

### 2026-01-28 v2.2.0 🎉 消しゴム太さ調整 + スクショ保存先指定！
- ✅ **消しゴムの太さを調整できるスライダーを追加**
- ✅ 消しゴムのデフォルトサイズ: 20px（5〜40pxで調整可能）
- ✅ ペンの太さ: 6px（2〜20pxで調整可能）
- ✅ **スクショ保存先を指定できるようになりました（PC）**
- ✅ File System Access API対応（Chrome/Edge）
- ✅ iPadでは共有メニューから保存先を選択可能
  - 写真に保存
  - ファイルに保存（任意のフォルダ）
  - その他のアプリに共有
- ✅ UIを改善（ペン設定をわかりやすく整理）

### 2026-01-28 v2.1.5 🎉 テストモードの描画問題を根本解決！
- ✅ **テストモードの描画が完璧になりました**
- ✅ answer-zoneのflexboxレイアウトを絶対配置に変更
- ✅ Canvasが確実に80x200pxで表示されるように修正
- ✅ カッコ（︵︶）がCanvasのサイズに影響を与えないように配置
- ✅ ガタガタの線が完全に解消されました
- ✅ デバッグログを追加（コンソールでCanvasサイズを確認可能）

### 2026-01-28 v2.1.4 🎉 テストモード描画の完全修正！
- ✅ **テストモードの描画が正確になりました**
- ✅ lineWidthのスケール調整を削除（Canvas内部サイズ=CSS表示サイズのため不要）
- ✅ ペンの太さが正確に6pxで描画される
- ✅ 消しゴムの太さが正確に20pxで描画される
- ✅ 座標のズレがなくなりました

### 2026-01-28 v2.1.3 🎉 テストモード描画修正 + 消しゴムサイズ変更！
- ✅ **テストモードのCanvas描画を完全修正（正確に書けるようになりました）**
- ✅ CanvasサイズをCSSサイズに合わせて調整（80x200px）
- ✅ answer-zoneの幅を80pxに変更
- ✅ **消しゴムのデフォルトサイズを20pxに変更**
- ✅ ペンのデフォルトサイズは6pxのまま

### 2026-01-28 v2.1.2 🎉 消しゴム機能の完全修正！
- ✅ **タッチデバイスでも消しゴムが正常に動作するように修正**
- ✅ handleTouchMove() に消しゴムモードを実装
- ✅ タッチ終了時にもglobalCompositeOperationをリセット
- ✅ スマホ・タブレットで消しゴムが使えるようになりました

### 2026-01-28 v2.1.1 🎉 消しゴム機能の修正！
- ✅ **消しゴムで消した部分に再度書き込めるように修正**
- ✅ 描画停止時に `globalCompositeOperation` をリセット
- ✅ ペンモードに戻るときに全Canvasをリセット

### 2026-01-28 v2.1 🎉 学年別問題数の保存機能追加！
- ✅ **学年別問題数がLocalStorageに保存されるようになりました**
- ✅ ページをリロードしても設定が保持されます
- ✅ 出題する漢字の選択状態も保存されます（既存機能）
- ✅ 最近出た漢字を除外の設定も保存されます（既存機能）

### 2026-01-28 v2.0 🎉 手書き機能大幅改善！
- ✅ **テストモードのCanvas描画を修正（綺麗に書けるようになりました）**
- ✅ **消しゴム機能追加（一部を消せるようになりました）**
- ✅ テストモードのCanvasサイズを固定（120x200px）
- ✅ 消しゴムボタン追加（🧹消しゴム / ✏️ペンに戻る）
- ✅ 消しゴムモード時は描画領域が2倍に
- ✅ ペン色変更時に消しゴムモード自動解除

### 2026-01-28 v1.1 🎉 PWA化完了 + 細長い画面対応！
- ✅ PWA完全実装（manifest.json + service-worker.js）
- ✅ アプリアイコン設定（512x512、192x192）
- ✅ スマホ完全対応（レスポンシブデザイン徹底）
- ✅ **細長い画面対応（320px〜480px）追加**
- ✅ **Service Workerをネットワーク優先に変更（常に最新版を取得）**
- ✅ **テストモードで手書きができるように修正**
- ✅ **スクロール時の誤描画防止（touch-action: none）**
- ✅ オフライン動作対応
- ✅ ホーム画面追加機能
- ✅ iOS/Android対応
- ✅ 小1漢字「口」の追加（79字→80字）
- ✅ 漢字検索機能の修正（全学年対応）
- ✅ 手書き練習のレイアウト改善
- ✅ テストモードの縦書きレイアウト実装

### 2024-01-XX
- ✅ 初回リリース
- ✅ プリント生成機能
- ✅ 手書き練習機能
- ✅ 漢字データ編集機能

---

## 📞 サポート

質問・バグ報告は「プログラミングのKOBEYA」までお問い合わせください。
